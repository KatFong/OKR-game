<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pixel Quest: AI OKR Mentor</title>
    <link rel="stylesheet" href="css/styles.css">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
</head>
<body class="bg-[#2c3e50] font-mono text-slate-900 h-screen flex flex-col overflow-hidden relative">

    <canvas id="confetti-canvas" class="fixed inset-0 pointer-events-none z-50"></canvas>

    <header class="shrink-0 h-16 bg-[#2c3e50] border-b-4 border-black shadow-lg relative z-20 flex items-center justify-between px-4">
        <div class="flex items-center gap-3">
            <div class="w-10 h-10 bg-[#9b59b6] border-4 border-white shadow-[2px_2px_0_0_#000] flex items-center justify-center">
                <i data-lucide="sparkles" class="text-white w-6 h-6"></i>
            </div>
            <div>
                <h1 class="text-xl font-black text-white tracking-widest drop-shadow-[2px_2px_0_#000] flex items-center gap-2">
                    PIXEL MENTOR <span class="hidden sm:inline text-[10px] bg-[#3498db] px-1 py-0.5 rounded text-white font-normal tracking-normal border border-white">AI POWERED</span>
                </h1>
            </div>
        </div>

        <div class="flex gap-2">
            <button id="btn-sound" class="p-2 border-2 border-white bg-[#2c3e50] text-white hover:bg-[#34495e] transition-all active:translate-y-1" title="Toggle Sound">
                <i data-lucide="volume-2" class="w-5 h-5"></i>
            </button>
            <button id="btn-settings" class="p-2 border-2 border-white bg-[#2c3e50] text-white hover:bg-[#34495e] transition-all active:translate-y-1" title="API Settings">
                <i data-lucide="settings" class="w-5 h-5"></i>
            </button>
            <button id="btn-sidebar-toggle" class="p-2 border-2 border-white bg-[#2c3e50] text-white hover:bg-[#34495e] transition-all active:translate-y-1 relative group" title="任務">
                <i data-lucide="list-todo" class="w-5 h-5"></i>
                <span id="sidebar-badge" class="absolute -top-1 -right-1 w-3 h-3 bg-[#e74c3c] border border-white hidden"></span>
            </button>
        </div>
    </header>

    <div id="modal-api-key" class="fixed inset-0 z-50 flex items-center justify-center bg-black/70 backdrop-blur-sm p-4 hidden">
        <div class="w-full max-w-md bg-[#ecf0f1] border-4 border-black shadow-[8px_8px_0_0_#000] p-6 animate-in fade-in zoom-in duration-200">
            <div class="flex justify-between items-center mb-4">
                <h2 class="text-xl font-black text-[#2c3e50] flex items-center gap-2 uppercase">
                    <i data-lucide="key" class="text-[#e67e22] w-6 h-6"></i> API Config
                </h2>
                <button id="btn-close-modal" class="text-slate-500 hover:text-black">
                    <i data-lucide="x" class="w-6 h-6"></i>
                </button>
            </div>

            <div class="space-y-4">
                <p class="text-sm text-slate-600 font-bold leading-relaxed">
                    通訊水晶需要魔力 (API Key) 才能運作。<br/>
                    請輸入您的 Google Gemini API Key:
                </p>

                <input type="password" id="input-api-key" placeholder="Paste your API Key here..." class="w-full p-3 bg-white border-4 border-[#bdc3c7] focus:border-[#3498db] outline-none font-mono text-sm" />

                <div class="text-xs text-slate-500 flex justify-between items-center">
                    <a href="https://aistudio.google.com/app/apikey" target="_blank" rel="noreferrer" class="text-[#3498db] underline hover:text-[#2980b9]">
                        獲取 API Key &rarr;
                    </a>
                    <span>Stored locally</span>
                </div>

                <div class="flex justify-end pt-2">
                    <button id="btn-save-key" class="bg-[#2ecc71] hover:bg-[#27ae60] text-white px-6 py-2 font-black border-4 border-[#27ae60] shadow-[4px_4px_0_0_#000] active:translate-y-1 active:shadow-none transition-all uppercase">
                        Save & Connect
                    </button>
                </div>
            </div>
        </div>
    </div>

    <div class="flex-1 flex overflow-hidden relative z-10 w-full h-full">

        <!-- 聊天區（主畫面） -->
        <div id="view-chat" class="flex-1 flex flex-col min-w-0 w-full h-full bg-[#2c3e50]">
            <div id="messages-container" class="flex-1 overflow-y-auto p-4 sm:p-6 space-y-6 scrollbar-retro">
            </div>
            <div id="loading-indicator" class="hidden p-4 sm:px-6 flex gap-3">
                <div class="shrink-0 w-10 h-10 border-2 border-black flex items-center justify-center overflow-hidden bg-[#9b59b6] rounded-none">
                    <img src="assets/lumina-avatar.png" alt="露米娜" class="w-full h-full object-cover object-top" />
                </div>
                <div class="p-3 bg-[#ecf0f1] border-2 border-black rounded-tr-xl rounded-br-xl rounded-bl-xl flex items-center gap-2">
                    <i data-lucide="loader-2" class="animate-spin text-slate-500 w-4 h-4"></i>
                    <span class="text-xs font-bold text-slate-500">Lumina is thinking...</span>
                </div>
            </div>
            <div class="p-4 sm:p-6 bg-[#34495e] border-t-4 border-black">
                <div class="flex gap-2 max-w-5xl mx-auto w-full">
                    <div class="flex-1 relative">
                        <div class="absolute inset-y-0 left-3 flex items-center pointer-events-none">
                            <i data-lucide="terminal" class="text-slate-400 w-4 h-4"></i>
                        </div>
                        <input type="text" id="chat-input" placeholder="輸入訊息回應導師..." class="w-full pl-9 pr-4 py-3 bg-[#2c3e50] border-2 border-slate-500 text-white placeholder:text-slate-500 focus:border-[#f1c40f] focus:outline-none font-bold disabled:opacity-50" />
                    </div>
                    <button id="btn-send" class="bg-[#2ecc71] hover:bg-[#27ae60] disabled:opacity-50 disabled:cursor-not-allowed text-white px-4 border-2 border-black shadow-[4px_4px_0_0_#000] active:translate-y-1 active:shadow-[2px_2px_0_0_#000] transition-all">
                        <i data-lucide="send" class="w-5 h-5"></i>
                    </button>
                </div>
            </div>
        </div>

        <!-- 獨立任務頁（與 ChatRoom 同 UI 風格，元件不變） -->
        <div id="view-tasks" class="hidden absolute inset-0 z-20 flex flex-col bg-[#2c3e50]">
            <header class="shrink-0 h-16 bg-[#2c3e50] border-b-4 border-black shadow-lg flex items-center px-4 gap-3">
                <button id="btn-tasks-back" class="flex items-center gap-2 py-2 px-3 border-2 border-white bg-[#2c3e50] text-white hover:bg-[#34495e] font-black text-sm uppercase tracking-wider active:translate-y-0.5 transition-all">
                    <i data-lucide="arrow-left" class="w-5 h-5"></i> 返回
                </button>
                <h2 class="flex-1 text-center text-xl font-black text-white tracking-widest drop-shadow-[2px_2px_0_#000]">任務</h2>
                <div class="w-24"></div>
            </header>
            <div class="shrink-0 flex bg-[#34495e] border-b-4 border-black">
                <button id="filter-my-tasks" class="flex-1 py-3 px-4 text-sm font-black text-[#f1c40f] border-r-2 border-black uppercase tracking-wider bg-[#3498db]">
                    我的任務
                </button>
                <button id="filter-ended-tasks" class="flex-1 py-3 px-4 text-sm font-bold text-slate-300 hover:text-white bg-[#34495e] border-r-2 border-black flex items-center justify-center gap-1 uppercase tracking-wider transition-colors">
                    已結束的任務 <i data-lucide="chevron-right" class="w-4 h-4"></i>
                </button>
            </div>
            <div id="task-cards-container" class="flex-1 overflow-y-auto p-4 sm:p-6 space-y-4 scrollbar-retro">
                <div id="task-cards-list" class="space-y-4"></div>
                <div id="task-cards-empty" class="hidden text-center py-12 text-slate-400 text-sm font-bold">
                    <p>尚無任務</p>
                    <p class="mt-1">返回與露米娜制定 OKR，任務會出現在這裡。</p>
                </div>
            </div>
        </div>

        <!-- 任務側欄（右上角「任務」圖示開啟） -->
        <div id="sidebar" class="fixed top-16 right-0 bottom-0 w-80 bg-[#fdf5e6] border-l-4 border-black transform translate-x-full z-30 shadow-[-10px_0_20px_rgba(0,0,0,0.5)] flex flex-col">
            <div class="p-4 bg-[#eec39a] border-b-4 border-[#8b4513] flex justify-between items-center shrink-0">
                <h2 class="font-black text-[#5d4037] flex items-center gap-2 uppercase">
                    <i data-lucide="list-todo" class="w-5 h-5"></i> 任務
                </h2>
                <button id="btn-close-sidebar" class="text-[#8b4513] hover:text-black">
                    <i data-lucide="x" class="w-6 h-6"></i>
                </button>
            </div>

            <div class="flex-1 overflow-y-auto p-4 space-y-4 scrollbar-retro">
                <!-- 總任務 List -->
                <section class="bg-[#ecf0f1] border-2 border-black p-3">
                    <h3 class="font-black text-[#2c3e50] text-xs uppercase tracking-wider flex items-center gap-1.5 mb-3">
                        <i data-lucide="target" class="w-4 h-4 text-[#e67e22]"></i> 總任務 List
                    </h3>
                    <div id="total-quest-list" class="space-y-3"></div>
                    <div id="total-quest-empty" class="text-center text-slate-500 py-4 text-xs font-bold">
                        <p>尚無總任務。</p>
                        <p class="mt-1">與露米娜制定 OKR 後會出現在這裡。</p>
                    </div>
                </section>
                <!-- 每日任務 -->
                <section class="bg-white border-2 border-[#8b4513] p-3">
                    <h3 class="font-black text-[#5d4037] text-xs uppercase tracking-wider flex items-center gap-1.5 mb-3">
                        <i data-lucide="calendar-check" class="w-4 h-4 text-[#e67e22]"></i> 每日任務
                    </h3>
                    <div class="flex gap-1.5 mb-3">
                        <input type="text" id="daily-task-input" placeholder="新增今日要做的事..." class="flex-1 px-2 py-1.5 text-sm bg-white border-2 border-[#d2b48c] text-slate-800 font-bold focus:border-[#e67e22] outline-none" />
                        <button id="btn-add-daily-task" class="bg-[#2ecc71] hover:bg-[#27ae60] text-white p-1.5 font-black border-2 border-black shadow-[2px_2px_0_0_#000] active:translate-y-0.5 transition-all">
                            <i data-lucide="plus" class="w-4 h-4"></i>
                        </button>
                    </div>
                    <div id="daily-tasks-list" class="space-y-1.5"></div>
                    <div id="daily-tasks-empty" class="text-center text-[#8b4513] opacity-70 py-4 text-xs font-bold">
                        今天還沒有每日任務，新增一項吧！
                    </div>
                </section>
            </div>
        </div>

    </div>

    <script src="js/system-prompt.js"></script>
    <script src="js/app.js"></script>
</body>
</html>
